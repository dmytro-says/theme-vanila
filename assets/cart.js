var C=Object.defineProperty;var b=(o,n,t)=>n in o?C(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t;var I=(o,n,t)=>b(o,typeof n!="symbol"?n+"":n,t);class f extends HTMLElement{constructor(){super(),this.addEventListener("click",n=>{n.preventDefault(),(this.closest("cart-items")||this.closest("cart-drawer-items")).updateQuantity(this.dataset.index,0,n)})}}customElements.define("cart-remove-button",f);class w extends HTMLElement{constructor(){super();I(this,"cartUpdateUnsubscriber");this.lineItemStatusElement=document.getElementById("shopping-cart-line-item-status")||document.getElementById("CartDrawer-LineItemStatus");const t=debounce(e=>{this.onChange(e)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",t.bind(this))}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,t=>{if(t.source!=="cart-items")return this.onCartUpdate()})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}resetQuantityInput(t){const e=this.querySelector(`#Quantity-${t}`);e.value=e.getAttribute("value"),this.isEnterPressed=!1}setValidity(t,e,a){t.target.setCustomValidity(a),t.target.reportValidity(),this.resetQuantityInput(e),t.target.select()}validateQuantity(t){const e=parseInt(t.target.value),a=t.target.dataset.index;let r="";e<t.target.dataset.min?r=window.quickOrderListStrings.min_error.replace("[min]",t.target.dataset.min):e>parseInt(t.target.max)?r=window.quickOrderListStrings.max_error.replace("[max]",t.target.max):e%parseInt(t.target.step)!==0&&(r=window.quickOrderListStrings.step_error.replace("[step]",t.target.step)),r?this.setValidity(t,a,r):(t.target.setCustomValidity(""),t.target.reportValidity(),this.updateQuantity(a,e,t,document.activeElement.getAttribute("name"),t.target.dataset.quantityVariantId))}onChange(t){this.validateQuantity(t)}onCartUpdate(){return this.tagName==="CART-DRAWER-ITEMS"?fetch(`${routes.cart_url}?section_id=cart-drawer`).then(t=>t.text()).then(t=>{const e=new DOMParser().parseFromString(t,"text/html"),a=["cart-drawer-items",".cart-drawer__footer"];for(const r of a){const i=document.querySelector(r),u=e.querySelector(r);i&&u&&i.replaceWith(u)}}).catch(t=>{console.error(t)}):fetch(`${routes.cart_url}?section_id=main-cart-items`).then(t=>t.text()).then(t=>{const a=new DOMParser().parseFromString(t,"text/html").querySelector("cart-items");this.innerHTML=a.innerHTML}).catch(t=>{console.error(t)})}getSectionsToRender(){return[{id:"main-cart-items",section:document.getElementById("main-cart-items").dataset.id,selector:".js-contents"},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"cart-live-region-text",section:"cart-live-region-text",selector:".shopify-section"},{id:"main-cart-footer",section:document.getElementById("main-cart-footer").dataset.id,selector:".js-contents"}]}updateQuantity(t,e,a,r,i){this.enableLoading(t);const u=JSON.stringify({line:t,quantity:e,sections:this.getSectionsToRender().map(d=>d.section),sections_url:window.location.pathname}),p=a.currentTarget instanceof f?"clear":"change";fetch(`${routes.cart_change_url}`,{...fetchConfig(),body:u}).then(d=>d.text()).then(d=>{const s=JSON.parse(d);CartPerformance.measure(`${p}:paint-updated-sections"`,()=>{const g=document.getElementById(`Quantity-${t}`)||document.getElementById(`Drawer-quantity-${t}`),S=document.querySelectorAll(".cart-item");if(s.errors){g.value=g.getAttribute("value"),this.updateLiveRegions(t,s.errors);return}this.classList.toggle("is-empty",s.item_count===0);const c=document.querySelector("cart-drawer"),E=document.getElementById("main-cart-footer");E&&E.classList.toggle("is-empty",s.item_count===0),c&&c.classList.toggle("is-empty",s.item_count===0),this.getSectionsToRender().forEach(m=>{const _=document.getElementById(m.id).querySelector(m.selector)||document.getElementById(m.id);_.innerHTML=this.getSectionInnerHTML(s.sections[m.section],m.selector)});const h=s.items[t-1]?s.items[t-1].quantity:void 0;let y="";S.length===s.items.length&&h!==parseInt(g.value)&&(typeof h>"u"?y=window.cartStrings.error:y=window.cartStrings.quantityError.replace("[quantity]",h)),this.updateLiveRegions(t,y);const l=document.getElementById(`CartItem-${t}`)||document.getElementById(`CartDrawer-Item-${t}`);l&&l.querySelector(`[name="${r}"]`)?c?trapFocus(c,l.querySelector(`[name="${r}"]`)):l.querySelector(`[name="${r}"]`).focus():s.item_count===0&&c?trapFocus(c.querySelector(".drawer__inner-empty"),c.querySelector("a")):document.querySelector(".cart-item")&&c&&trapFocus(c,document.querySelector(".cart-item__name"))}),CartPerformance.measureFromEvent(`${p}:user-action`,a),publish(PUB_SUB_EVENTS.cartUpdate,{source:"cart-items",cartData:s,variantId:i})}).catch(()=>{this.querySelectorAll(".loading__spinner").forEach(s=>s.classList.add("hidden"));const d=document.getElementById("cart-errors")||document.getElementById("CartDrawer-CartErrors");d.textContent=window.cartStrings.error}).finally(()=>{this.disableLoading(t)})}updateLiveRegions(t,e){const a=document.getElementById(`Line-item-error-${t}`)||document.getElementById(`CartDrawer-LineItemError-${t}`);a&&(a.querySelector(".cart-item__error-text").textContent=e),this.lineItemStatusElement.setAttribute("aria-hidden",!0);const r=document.getElementById("cart-live-region-text")||document.getElementById("CartDrawer-LiveRegionText");r.setAttribute("aria-hidden",!1),setTimeout(()=>{r.setAttribute("aria-hidden",!0)},1e3)}getSectionInnerHTML(t,e){return new DOMParser().parseFromString(t,"text/html").querySelector(e).innerHTML}enableLoading(t){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.add("cart__items--disabled");const a=this.querySelectorAll(`#CartItem-${t} .loading__spinner`),r=this.querySelectorAll(`#CartDrawer-Item-${t} .loading__spinner`);[...a,...r].forEach(i=>i.classList.remove("hidden")),document.activeElement.blur(),this.lineItemStatusElement.setAttribute("aria-hidden",!1)}disableLoading(t){(document.getElementById("main-cart-items")||document.getElementById("CartDrawer-CartItems")).classList.remove("cart__items--disabled");const a=this.querySelectorAll(`#CartItem-${t} .loading__spinner`),r=this.querySelectorAll(`#CartDrawer-Item-${t} .loading__spinner`);a.forEach(i=>i.classList.add("hidden")),r.forEach(i=>i.classList.add("hidden"))}}customElements.define("cart-items",w);customElements.get("cart-note")||customElements.define("cart-note",class extends HTMLElement{constructor(){super(),this.addEventListener("input",debounce(n=>{const t=JSON.stringify({note:n.target.value});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:t}).then(()=>CartPerformance.measureFromEvent("note-update:user-action",n))},ON_CHANGE_DEBOUNCE_TIMER))}});
