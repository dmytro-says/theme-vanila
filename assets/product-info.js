var U=Object.defineProperty;var P=(f,m,t)=>m in f?U(f,m,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[m]=t;var p=(f,m,t)=>P(f,typeof m!="symbol"?m+"":m,t);customElements.get("product-info")||customElements.define("product-info",class extends HTMLElement{constructor(){super();p(this,"quantityInput");p(this,"quantityForm");p(this,"onVariantChangeUnsubscriber");p(this,"cartUpdateUnsubscriber");p(this,"abortController");p(this,"pendingRequestUrl",null);p(this,"preProcessHtmlCallbacks",[]);p(this,"postProcessHtmlCallbacks",[]);this.quantityInput=this.querySelector(".quantity__input")}connectedCallback(){this.initializeProductSwapUtility(),this.onVariantChangeUnsubscriber=subscribe(PUB_SUB_EVENTS.optionValueSelectionChange,this.handleOptionValueChange.bind(this)),this.initQuantityHandlers(),this.dispatchEvent(new CustomEvent("product-info:loaded",{bubbles:!0}))}addPreProcessCallback(t){this.preProcessHtmlCallbacks.push(t)}initQuantityHandlers(){this.quantityInput&&(this.quantityForm=this.querySelector(".product-form__quantity"),this.quantityForm&&(this.setQuantityBoundries(),this.dataset.originalSection||(this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,this.fetchQuantityRules.bind(this)))))}disconnectedCallback(){var t;this.onVariantChangeUnsubscriber(),(t=this.cartUpdateUnsubscriber)==null||t.call(this)}initializeProductSwapUtility(){this.preProcessHtmlCallbacks.push(t=>t.querySelectorAll(".scroll-trigger").forEach(i=>i.classList.add("scroll-trigger--cancel"))),this.postProcessHtmlCallbacks.push(t=>{var i,e,n;(e=(i=window==null?void 0:window.Shopify)==null?void 0:i.PaymentButton)==null||e.init(),(n=window==null?void 0:window.ProductModel)==null||n.loadShopifyXR()})}handleOptionValueChange({data:{event:t,target:i,selectedOptionValues:e}}){if(!this.contains(t.target))return;this.resetProductFormState();const n=i.dataset.productUrl||this.pendingRequestUrl||this.dataset.url;this.pendingRequestUrl=n;const a=this.dataset.url!==n,r=this.dataset.updateUrl==="true"&&a;this.renderProductInfo({requestUrl:this.buildRequestUrlWithParams(n,e,r),targetId:i.id,callback:a?this.handleSwapProduct(n,r):this.handleUpdateProductInfo(n)})}resetProductFormState(){const t=this.productForm;t==null||t.toggleSubmitButton(!0),t==null||t.handleErrorMessage()}handleSwapProduct(t,i){return e=>{var r;(r=this.productModal)==null||r.remove();const n=i?"product-info[id^='MainProduct']":"product-info",a=this.getSelectedVariant(e.querySelector(n));this.updateURL(t,a==null?void 0:a.id),i?(document.querySelector("head title").innerHTML=e.querySelector("head title").innerHTML,HTMLUpdateUtility.viewTransition(document.querySelector("main"),e.querySelector("main"),this.preProcessHtmlCallbacks,this.postProcessHtmlCallbacks)):HTMLUpdateUtility.viewTransition(this,e.querySelector("product-info"),this.preProcessHtmlCallbacks,this.postProcessHtmlCallbacks)}}renderProductInfo({requestUrl:t,targetId:i,callback:e}){var n;(n=this.abortController)==null||n.abort(),this.abortController=new AbortController,fetch(t,{signal:this.abortController.signal}).then(a=>a.text()).then(a=>{this.pendingRequestUrl=null;const r=new DOMParser().parseFromString(a,"text/html");e(r)}).then(()=>{var a;(a=document.querySelector(`#${i}`))==null||a.focus()}).catch(a=>{a.name==="AbortError"?console.log("Fetch aborted by user"):console.error(a)})}getSelectedVariant(t){var e;const i=(e=t.querySelector("variant-selects [data-selected-variant]"))==null?void 0:e.innerHTML;return i?JSON.parse(i):null}buildRequestUrlWithParams(t,i,e=!1){const n=[];return!e&&n.push(`section_id=${this.sectionId}`),i.length&&n.push(`option_values=${i.join(",")}`),`${t}?${n.join("&")}`}updateOptionValues(t){const i=t.querySelector("variant-selects");i&&HTMLUpdateUtility.viewTransition(this.variantSelectors,i,this.preProcessHtmlCallbacks)}handleUpdateProductInfo(t){return i=>{var a,r,c,d,h,y;const e=this.getSelectedVariant(i);if((a=this.pickupAvailability)==null||a.update(e),this.updateOptionValues(i),this.updateURL(t,e==null?void 0:e.id),this.updateVariantInputs(e==null?void 0:e.id),!e){this.setUnavailable();return}this.updateMedia(i,(r=e==null?void 0:e.featured_media)==null?void 0:r.id);const n=(s,S=l=>!1)=>{const l=i.getElementById(`${s}-${this.sectionId}`),o=this.querySelector(`#${s}-${this.dataset.section}`);l&&o&&(o.innerHTML=l.innerHTML,o.classList.toggle("hidden",S(l)))};n("price"),n("Sku",({classList:s})=>s.contains("hidden")),n("Inventory",({innerText:s})=>s===""),n("Volume"),n("Price-Per-Item",({classList:s})=>s.contains("hidden")),this.updateQuantityRules(this.sectionId,i),(c=this.querySelector(`#Quantity-Rules-${this.dataset.section}`))==null||c.classList.remove("hidden"),(d=this.querySelector(`#Volume-Note-${this.dataset.section}`))==null||d.classList.remove("hidden"),(y=this.productForm)==null||y.toggleSubmitButton(((h=i.getElementById(`ProductSubmitButton-${this.sectionId}`))==null?void 0:h.hasAttribute("disabled"))??!0,window.variantStrings.soldOut),publish(PUB_SUB_EVENTS.variantChange,{data:{sectionId:this.sectionId,html:i,variant:e}})}}updateVariantInputs(t){this.querySelectorAll(`#product-form-${this.dataset.section}, #product-form-installment-${this.dataset.section}`).forEach(i=>{const e=i.querySelector('input[name="id"]');e.value=t??"",e.dispatchEvent(new Event("change",{bubbles:!0}))})}updateURL(t,i){var e;(e=this.querySelector("share-button"))==null||e.updateUrl(`${window.shopUrl}${t}${i?`?variant=${i}`:""}`),this.dataset.updateUrl!=="false"&&window.history.replaceState({},"",`${t}${i?`?variant=${i}`:""}`)}setUnavailable(){var i;(i=this.productForm)==null||i.toggleSubmitButton(!0,window.variantStrings.unavailable);const t=["price","Inventory","Sku","Price-Per-Item","Volume-Note","Volume","Quantity-Rules"].map(e=>`#${e}-${this.dataset.section}`).join(", ");document.querySelectorAll(t).forEach(({classList:e})=>e.add("hidden"))}updateMedia(t,i){var d,h,y;if(!i)return;const e=this.querySelector("media-gallery ul"),n=t.querySelector("media-gallery ul"),a=()=>{this.hasAttribute("data-zoom-on-hover")&&enableZoomOnHover(2);const s=Array.from(e.querySelectorAll("li[data-media-id]")),S=new Set(s.map(o=>o.dataset.mediaId)),l=new Map(s.map((o,q)=>[o.dataset.mediaId,{item:o,index:q}]));return[s,S,l]};if(e&&n){let[s,S,l]=a();const o=Array.from(n.querySelectorAll("li[data-media-id]")),q=new Set(o.map(({dataset:u})=>u.mediaId));let b=!1;for(let u=o.length-1;u>=0;u--)S.has(o[u].dataset.mediaId)||(e.prepend(o[u]),b=!0);for(let u=0;u<s.length;u++)q.has(s[u].dataset.mediaId)||(s[u].remove(),b=!0);b&&([s,S,l]=a()),o.forEach((u,I)=>{const g=l.get(u.dataset.mediaId);g&&g.index!==I&&(e.insertBefore(g.item,e.querySelector(`li:nth-of-type(${I+1})`)),[s,S,l]=a())})}(h=(d=this.querySelector("media-gallery"))==null?void 0:d.setActiveMedia)==null||h.call(d,`${this.dataset.section}-${i}`,!0);const r=(y=this.productModal)==null?void 0:y.querySelector(".product-media-modal__content"),c=t.querySelector("product-modal .product-media-modal__content");r&&c&&(r.innerHTML=c.innerHTML)}setQuantityBoundries(){const t={cartQuantity:this.quantityInput.dataset.cartQuantity?parseInt(this.quantityInput.dataset.cartQuantity):0,min:this.quantityInput.dataset.min?parseInt(this.quantityInput.dataset.min):1,max:this.quantityInput.dataset.max?parseInt(this.quantityInput.dataset.max):null,step:this.quantityInput.step?parseInt(this.quantityInput.step):1};let i=t.min;const e=t.max===null?t.max:t.max-t.cartQuantity;e!==null&&(i=Math.min(i,e)),t.cartQuantity>=t.min&&(i=Math.min(i,t.step)),this.quantityInput.min=i,e?this.quantityInput.max=e:this.quantityInput.removeAttribute("max"),this.quantityInput.value=i,publish(PUB_SUB_EVENTS.quantityUpdate,void 0)}fetchQuantityRules(){var i,e;const t=(e=(i=this.productForm)==null?void 0:i.variantIdInput)==null?void 0:e.value;if(t)return this.querySelector(".quantity__rules-cart .loading__spinner").classList.remove("hidden"),fetch(`${this.dataset.url}?variant=${t}&section_id=${this.dataset.section}`).then(n=>n.text()).then(n=>{const a=new DOMParser().parseFromString(n,"text/html");this.updateQuantityRules(this.dataset.section,a)}).catch(n=>console.error(n)).finally(()=>this.querySelector(".quantity__rules-cart .loading__spinner").classList.add("hidden"))}updateQuantityRules(t,i){if(!this.quantityInput)return;this.setQuantityBoundries();const e=i.getElementById(`Quantity-Form-${t}`),n=[".quantity__input",".quantity__rules",".quantity__label"];for(let a of n){const r=this.quantityForm.querySelector(a),c=e.querySelector(a);if(!(!r||!c))if(a===".quantity__input"){const d=["data-cart-quantity","data-min","data-max","step"];for(let h of d){const y=c.getAttribute(h);y!==null?r.setAttribute(h,y):r.removeAttribute(h)}}else r.innerHTML=c.innerHTML}}get productForm(){return this.querySelector("product-form")}get productModal(){return document.querySelector(`#ProductModal-${this.dataset.section}`)}get pickupAvailability(){return this.querySelector("pickup-availability")}get variantSelectors(){return this.querySelector("variant-selects")}get relatedProducts(){const t=SectionId.getIdForSection(SectionId.parseId(this.sectionId),"related-products");return document.querySelector(`product-recommendations[data-section-id^="${t}"]`)}get quickOrderList(){const t=SectionId.getIdForSection(SectionId.parseId(this.sectionId),"quick_order_list");return document.querySelector(`quick-order-list[data-id^="${t}"]`)}get sectionId(){return this.dataset.originalSection||this.dataset.section}});
