customElements.get("quick-add-bulk")||customElements.define("quick-add-bulk",class extends BulkAdd{constructor(){super(),this.quantity=this.querySelector("quantity-input");const t=debounce(e=>{parseInt(e.target.value)===0?this.startQueue(e.target.dataset.index,parseInt(e.target.value)):this.validateQuantity(e)},ON_CHANGE_DEBOUNCE_TIMER);this.addEventListener("change",t.bind(this)),this.listenForActiveInput(),this.listenForKeydown(),this.lastActiveInputId=null}connectedCallback(){this.cartUpdateUnsubscriber=subscribe(PUB_SUB_EVENTS.cartUpdate,t=>{t.source==="quick-add"||t.cartData.items&&!t.cartData.items.some(e=>e.id===parseInt(this.dataset.index))||t.cartData.variant_id&&t.cartData.variant_id!==parseInt(this.dataset.index)||this.onCartUpdate().then(()=>{this.listenForActiveInput(),this.listenForKeydown()})})}disconnectedCallback(){this.cartUpdateUnsubscriber&&this.cartUpdateUnsubscriber()}get input(){return this.querySelector("quantity-input input")}selectProgressBar(){return this.querySelector(".progress-bar-container")}listenForActiveInput(){var t;this.classList.contains("hidden")||(t=this.input)==null||t.addEventListener("focusin",e=>e.target.select()),this.isEnterPressed=!1}listenForKeydown(){var t;(t=this.input)==null||t.addEventListener("keydown",e=>{var i;e.key==="Enter"&&((i=this.input)==null||i.blur(),this.isEnterPressed=!0)})}cleanErrorMessageOnType(t){t.target.addEventListener("keypress",()=>{t.target.setCustomValidity("")},{once:!0})}get sectionId(){return this._sectionId||(this._sectionId=this.closest(".collection-quick-add-bulk").dataset.id),this._sectionId}onCartUpdate(){return new Promise((t,e)=>{fetch(`${this.getSectionsUrl()}?section_id=${this.sectionId}`).then(i=>i.text()).then(i=>{const n=new DOMParser().parseFromString(i,"text/html").querySelector(`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`);n&&(this.innerHTML=n.innerHTML),t()}).catch(i=>{console.error(i),e(i)})})}getSectionsUrl(){const t=new URLSearchParams(window.location.search),e=decodeURIComponent(t.get("page")||"");return`${window.location.pathname}${e?`?page=${e}`:""}`}updateMultipleQty(t){this.selectProgressBar().classList.remove("hidden");const e=Object.keys(t),i=JSON.stringify({updates:t,sections:this.getSectionsToRender().map(s=>s.section),sections_url:this.getSectionsUrl()});fetch(`${routes.cart_update_url}`,{...fetchConfig(),body:i}).then(s=>s.text()).then(s=>{const n=JSON.parse(s);this.renderSections(n,e),publish(PUB_SUB_EVENTS.cartUpdate,{source:"quick-add",cartData:n})}).catch(()=>{}).finally(()=>{this.selectProgressBar().classList.add("hidden"),this.setRequestStarted(!1)})}getSectionsToRender(){return[{id:`quick-add-bulk-${this.dataset.index}-${this.sectionId}`,section:this.sectionId,selector:`#quick-add-bulk-${this.dataset.index}-${this.sectionId}`},{id:"cart-icon-bubble",section:"cart-icon-bubble",selector:".shopify-section"},{id:"CartDrawer",selector:".drawer__inner",section:"cart-drawer"}]}renderSections(t,e){this.queue.filter(s=>e.includes(s.id)).length===0&&(this.getSectionsToRender().forEach(s=>{var a;const n=document.getElementById(s.id);s.section==="cart-drawer"&&((a=n.closest("cart-drawer"))==null||a.classList.toggle("is-empty",t.items.length.length===0));const r=n&&n.querySelector(s.selector)?n.querySelector(s.selector):n;r&&(r.innerHTML=this.getSectionInnerHTML(t.sections[s.section],s.selector))}),this.isEnterPressed&&this.querySelector(`#Quantity-${this.lastActiveInputId}`).select(),this.listenForActiveInput(),this.listenForKeydown())}});
